<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../view-index.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../../bower_components/polymer-dragula/polymer-dragula-styles.html">
<dom-module id="view-plan-production">
  <template>
    <style is="custom-style" include="polymer-dragula-styles"></style>
    <style include="shared-styles">
       :host {
        display: block;
        --app-grid-item-height: 50%;
        --vaadin-context-menu-overlay: {
          background-color: #ffffff;
        }
      }

      @media (min-width: 360px) and (max-width: 768px) {
         :host {
          --app-grid-columns: 1;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
         :host {
          --app-grid-columns: 2;
        }
      }

      @media (min-width: 1025px) and (max-width: 1200px) {
         :host {
          --app-grid-columns: 2;
        }
      }

      @media (min-width: 1201px) and (max-width: 2560px) {
         :host {
          --app-grid-columns: 2;
        }
      }

      paper-item:hover { color: #FFFFFF; background-color: #333333; }

      .vertical-section-container {
        max-width: 600px;
      }

      .row {
        border: 1px dotted #999999;
        margin: 15px;
        width: 100%;
        padding: 15px;
      }

      .column {
        border: 1px dotted #0d47a1;
        margin: 5px;
        display: block;
        padding: 15px;
        background-color: #ffcc80;
      }

      .red {
        background-color: red;
      }

      .green {
        background-color: green;
      }

      .blue {
        background-color: blue;
      }

      .gu-mirror {
        position: fixed !important;
        margin: 0 !important;
        z-index: 9999 !important;
        opacity: 0.8;
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";
        filter: alpha(opacity=80);
      }

      .gu-hide {
        display: none !important;
      }

      .gu-unselectable {
        -webkit-user-select: none !important;
        -moz-user-select: none !important;
        -ms-user-select: none !important;
        user-select: none !important;
      }

      .gu-transit {
        opacity: 0.2;
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";
        filter: alpha(opacity=20);
      }

      .red {
        background-color: red;
      }

      .green {
        background-color: green;
      }

      .blue {
        background-color: blue;
      }

      .handle-inner,
      .handle {
        border: 3px solid;
        border-radius: 15px;
        padding: 5px;
        cursor: move;
        cursor: grab;
        cursor: -moz-grab;
        cursor: -webkit-grab;
        margin-bottom: 5px;
        display: inline-block;
      }
    </style>
    <firebase-query id="productQuery" path="/product" orderByChild="name" data="{{productItems}}"></firebase-query>
    <div class="card">
      <h1>Simulation Machine</h1>
      <div style="border: solid 1px #333333; margin-top:30px; width: 100%; height: 300px; overflow:hidden;"></div>
    </div>
    <div class="card">
      <h1>Production Simulation</h1>
        <paper-button raised class="magic" on-tap="_addStation">Add station</paper-button>
     
      <vaadin-combo-box label="Product" name="product" items="[[productItems]]" id="productSelector" on-tap="selectProduct" item-label-path="name"
        item-value-path="name" selected-item='{{x}}' required always-float-label></vaadin-combo-box>
      <vaadin-combo-box label="Size" name="size" items="[[x.size]]" id="sizeSelector" on-tap="selectSize" disabled="true" item-label-path="name"
        item-value-path="length" required always-float-label></vaadin-combo-box>
      <vaadin-combo-box label="Load Plan" name="plan" items="" id="planSelector" on-tap="selectPlan" disabled="true" item-label-path="name"
        item-value-path="name" required always-float-label></vaadin-combo-box>


      <vaadin-context-menu selector=".stationBox">
        <template>
          <paper-menu>      
            <paper-item on-tap="{{_addStation}}" class="test-station">New station</paper-item>
            <paper-item disabled="[[!stations]]" on-tap="_renameStation">Rename [[index]]</paper-item>
            <paper-item disabled="[[!stations]]" list-item="[[target]]" on-tap="_removeStation">Delete station</paper-item>
          </paper-menu>
         </template>

        <div class="production-block" style="border: solid 1px #333333; border-radius: 2px; margin:30px 0; width: 100%; min-height: 500px; overflow:auto;">
          <template is="dom-repeat" items="[[stations]]" as="station">
            <div class="stationBox" index="[[index]]"><h2>[[station.name]]</h2>
            <p>Station [[index]]</p>
            </div>
          </template>
          <template is="dom-if" if="[[stations]]" hidden$="[[stations]]">
              <div class="stationBox" style="min-height: 500px; height: 100%;" index="[[index]]"><h2>No station in production block.</h2>
              <p>Please add your first station to the block. [[stations]]</p>
              </div>
          </template>
        </div>
      </vaadin-context-menu>
      <div class="button-group">
        <paper-button raised class="burn" on-tap="_simulatePlan">Simulate</paper-button>
        <paper-button raised class="magic" on-tap="_savePlan">Save</paper-button>
      </div>
    </div>
 
       <polymer-dragula id="column-dragger" sub-container-selector=".col-holder" fn-moves="[[fnMovesInner]]">
            <polymer-dragula id="row-dragger" fn-moves="[[fnMoves]]">
                <div class="row-holder">
                    <template is="dom-repeat" items="[[data.rows]]">
                        <div class$="row [[item.className]]">
                            <strong class="handle">drag handle</strong>
                            <div class="col-holder">
                                <template is="dom-repeat" items="[[item.columns]]">
                                    <div class="column">
                                        <strong class="handle-inner">drag handle</strong>
                                        <p>[[item.body]]</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </polymer-dragula>
        </polymer-dragula>
  
    <div class="card">
      DEBUG CONSOLE
      <div>
        <button id="SaveButton" onclick="save()">Save</button>
        <button onclick="load()">Load</button> Diagram Model saved in JSON format:
      </div>
      <textarea id="mySavedModel" style="width:100%;height:300px">
{ "class": "go.GraphLinksModel",
  "nodeCategoryProperty": "type",
  "linkFromPortIdProperty": "frompid",
  "linkToPortIdProperty": "topid",
  "nodeDataArray": [
{"key":1, "type":"Table", "name":"Product"},
{"key":2, "type":"Table", "name":"Sales"},
{"key":3, "type":"Table", "name":"Period"},
{"key":4, "type":"Table", "name":"Store"},
{"key":11, "type":"Join", "name":"Product, Class"},
{"key":12, "type":"Join", "name":"Period"},
{"key":13, "type":"Join", "name":"Store"},
{"key":21, "type":"Project", "name":"Product, Class"},
{"key":31, "type":"Filter", "name":"Boston, Jan2014"},
{"key":32, "type":"Filter", "name":"Boston, 2014"},
{"key":41, "type":"Group", "name":"Sales"},
{"key":42, "type":"Group", "name":"Total Sales"},
{"key":51, "type":"Join", "name":"Product Name"},
{"key":61, "type":"Sort", "name":"Product Name"},
{"key":71, "type":"Export", "name":"File"}
  ],
  "linkDataArray": [
{"from":1, "frompid":"OUT", "to":11, "topid":"L"},
{"from":2, "frompid":"OUT", "to":11, "topid":"R"},
{"from":3, "frompid":"OUT", "to":12, "topid":"R"},
{"from":4, "frompid":"OUT", "to":13, "topid":"R"},
{"from":11, "frompid":"M", "to":12, "topid":"L"},
{"from":12, "frompid":"M", "to":13, "topid":"L"},
{"from":13, "frompid":"M", "to":21},
{"from":21, "frompid":"OUT", "to":31},
{"from":21, "frompid":"OUT", "to":32},
{"from":31, "frompid":"OUT", "to":41},
{"from":32, "frompid":"OUT", "to":42},
{"from":41, "frompid":"OUT", "to":51, "topid":"L"},
{"from":42, "frompid":"OUT", "to":51, "topid":"R"},
{"from":51, "frompid":"OUT", "to":61},
{"from":61, "frompid":"OUT", "to":71}
  ]}
    </textarea>
  
            <vaadin-context-menu selector="li">
              <template>
                <paper-menu>
                  <paper-item on-tap="_appendItem">Append item</paper-item>
                  <paper-item list-item="[[target]]" on-tap="_removeItem">Remove item</paper-item>
                </paper-menu>
              </template>

              <ul>
                <template is="dom-repeat" items="[[items]]">
                  <li index="[[index]]">[[item]]</li>
                </template>
              </ul>
            </vaadin-context-menu>
        
    </div>
      <paper-dialog id="createProductDialog" class="product-dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" alwaysOnTop="true"
            role="dialog" no-cancel-on-outside-click>
            <h1>Add Product</h1>
            <paper-input name="product-name" id="productName" label="Product Name" required always-float-label></paper-input>
            <paper-input name="product-sku" id="productSku" label="SKU Number" allowed-pattern="[0-9]" required always-float-label></paper-input>
            <paper-input name="product-process" id="productProcess" label="Product Process (use comma to separate the process)" required always-float-label></paper-input>
            <paper-input name="product-raw" id="productRaw" label="Raw Material (use comma to separate the process)" required always-float-label></paper-input>
            <template is="dom-repeat" items="{{foodArray}}" as="food">
                <div class="container flex-horizontal">
								<paper-input class="product-size flex-child" label="Size name" value="[[food.name]]" required always-float-label></paper-input>
								<paper-input class="product-size" label="Cycle time" value="{{food.unit}}" required always-float-label></paper-input>
                <paper-input class="product-size" label="Cost" value="{{food.cost}}" required always-float-label></paper-input>	
								<iron-icon on-click="deleteSize" icon="vaadin:close"></iron-icon>	
                </div>
			    	</template>
	  
					<paper-button on-tap="addFood">Add Size</paper-button>
            <label for="fileUpload">Product image</label>
            <input type="file" value="upload" on-change="upld" id="fileUpload"/>
            
              <div class="buttons">
                <paper-button dialog-dismiss>Dismiss</paper-button>
                <paper-button on-tap="addProduct" dialog-confirm autofocus>Create</paper-button>
              </div>
           </paper-dialog>
  </template>
  <script>
    Polymer({
      is: 'view-plan-production',
      properties: {
        fnMoves: {
          type: Function,
          value: function () {
            return function (el, container, handle) {
              return handle.classList.contains('handle');
            }
          }
        },
        fnMovesInner: {
          type: Function,
          value: function () {
            return function (el, container, handle) {
              return handle.classList.contains('handle-inner');
            }
          }
        },
        productItems: {
          type: Object
        },
        productionDiagram: {
          notify: true
        },
        stations: {
          type: Object,
          value: function() {
            return [];
          }
      },
        data: {
          type: Object,
          value: function () {
            return {
              rows: [{
                  className: 'red',
                  columns: [{
                      body: "item-1"
                    },
                    {
                      body: "item-2"
                    }
                  ]
                },
                {
                  className: 'green',
                  columns: [{
                      body: "item-3"
                    },
                    {
                      body: "item-4"
                    }
                  ]
                },
                {
                  className: 'blue',
                  columns: [{
                      body: "item-5"
                    },
                    {
                      body: "item-6"
                    },
                    {
                      body: "item-7"
                    }
                  ]
                }
              ]
            };
          }
        },
            items: {
                  type: Array,
                  value: function() {
                    return ['Foo', 'Bar', 'Baz'];
                  }
                }
              },

              _appendItem: function() {
                this.push('items', 'New item');
              },

              _removeItem: function(e) {
                var menuItem = e.target; // `<paper-item>`
                var listItem = menuItem.listItem; // `<li>`
                this.splice('items', listItem.index, 1);
              },


       _addStation: function() {
        this.push('stations', {name: 'New Station'});
        console.log("New station added!!");
      },
      _renameStation: function(e) {
        console.log("Rename station no: " + e.model.index);
      },
      _removeStation: function(e) {
       // let menuItem = e.target; // `<paper-item>`
       // let listItem = menuItem.listItem; // `<li>`
        //this.splice('items', listItem.index, 1);
       // this.splice('items',e.target.index,1);
       
        this.splice('stations',e.model.index,1);
        console.log("Station item removed!!" + e.currentTarget + " | " + e.model.index + " | " + e.target);
      },
      _savePlan: function() {
        console.log(this.stations);
      },
      listeners: {
        'dragula-drag': 'handleEvent',
        'dragula-dragend': 'handleEvent',
        'dragula-drop': 'handleEvent',
        'dragula-cancel': 'handleEvent',
        'dragula-remove': 'handleEvent',
        'dragula-shadow': 'handleEvent',
        'dragula-over': 'handleEvent',
        'dragula-out': 'handleEvent',
        'dragula-cloned': 'handleEvent'
      },
      handleEvent: function (event) {
        console.log(event.type, event.detail);
      },
    });
  </script>
</dom-module>