<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../view-index.html">
<link rel="import" href="../shared-styles.html">
<dom-module id="view-setup-machine">
  <template>
    <style include="shared-styles">
       :host {
        display: block;
        --app-grid-columns: 3;
        /* 50% the width of the item is equivalent to 2:1 aspect ratio*/
        --app-grid-item-height: 50%;
      }
      
      ul {
        padding: 0;
        list-style: none;
      }
      
       @media (min-width: 360px) and (max-width: 768px) {
         :host {
          --app-grid-columns: 1;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
         :host {
          --app-grid-columns: 2;
        }
      }

      @media (min-width: 1025px) and (max-width: 1200px) {
         :host {
          --app-grid-columns: 3;
        }
      }
       @media (min-width: 1201px) and (max-width: 2560px) {
         :host {
          --app-grid-columns: 4;
        }
      }

      .machine-dialog {
        width: 35%;
        padding: 10px;
      }
      .stitched {
        height: auto;
        min-height: 330px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        margin: 10px 10px 10px 10px;
        padding: 16px;
        color: #757575;
        border: 4px dashed #757575;
        border-radius: 2px;
        flex-direction: column;
        text-decoration: none;
        position: relative;
        box-sizing: border-box;
     }
     .machine { min-height: 330px; height: auto; }
     .machine h1 { text-align: center; }
     .new-machine { margin: 0; padding: 20px 40px; font-size: 1.25rem; }
     .machine p {
        margin: 12px 0;
      }
     .machine-info-group {
       margin-bottom: auto;
     }
     .button-group {
       margin-top: auto;
     }
     .button-group paper-button {
       display: flex;
       align-items: center; 
       justify-content: center; 
     }
     paper-dialog .buttons {
       padding-top: 20px !important;
     }
     
    </style>
    <firebase-auth user="{{user}}"></firebase-auth>
    <firebase-query id="machineQuery" path="/machine" orderByChild="install" data="{{machineItems}}"></firebase-query>
    <ul class="app-grid">
      <li>
        <div class="stitched">
          <paper-button raised on-tap="toggleDialog" class="new-machine magic">Add machine</paper-button>
          <paper-dialog id="createMachineDialog" class="machine-dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" alwaysOnTop="true"
            role="dialog">
            <h2>Add machine</h2>
            <paper-input name="machine-name" id="machineName" label="Machine Name" required always-float-label></paper-input>
            <paper-input name="machine-effi" id="machineEffi" label="Efficiency" type="number"  min="0" max="100" value="100" step="5" allowed-pattern="[0-9]" required always-float-label><div suffix>%</div></paper-input>
            <vaadin-combo-box label="Type" id="machineType" items="[[machineType]]" id="product-select" name="machineType" item-label-path="name"
              item-value-path="symbol" item-code-path="number" required always-float-label></vaadin-combo-box>
              <div class="buttons">
                <paper-button dialog-dismiss>Dismiss</paper-button>
                <paper-button on-tap="addMachine" dialog-confirm autofocus>Create</paper-button>
              </div>
              </paper-dialog>
        </div>
      </li>
      <template is="dom-repeat" items="{{machineItems}}" as="machineItem">
        <li>  
          <div class="card machine">
            <div class="machine-info-group">
            <h1 class="name">[[machineItem.name]]</h1>
            <p>Machine Type: [[machineItem.type]]</p>
            <p>Current Efficiency: [[machineItem.effi]] &#37;</p>
            <p>Installed date: [[machineItem.install]]</p>
            <p>Machine Status: <span class="machine-status">[[machineItem.status]]</span></p>
            </div>
            <paper-dialog id="[[machineItem.$key]]" class="machine-dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" alwaysOnTop="true" role="dialog">
            <h2>Edit machine</h2>
            <paper-input name="machine-name" class="editmachineName" value="[[machineItem.name]]" label="Machine Name" always-float-label></paper-input>
            <paper-input name="machine-effi" class="editmachineEffi" value="[[machineItem.effi]]" label="Efficiency" type="number" min="0" max="100" step="5" allowed-pattern="[0-9]" always-float-label>
            <div suffix>%</div> 
            </paper-input>
            <vaadin-combo-box label="Type" class="editmachineType" value="[[machineItem.type]]" items="[[machineType]]" name="machineType" item-label-path="name"
              item-value-path="symbol" item-code-path="number" always-float-label></vaadin-combo-box>
              <div class="buttons">
                <paper-button dialog-dismiss>Dismiss</paper-button>
                <paper-button on-tap="saveMachine" dialog-confirm autofocus>Save</paper-button>
              </div>
              </paper-dialog>
             <div class="button-group">
            <paper-button raised class="water" value="[[machineItem.$key]]" on-tap="editMachine" style="margin-bottom: 10px;">EDIT</paper-button>
            <paper-button raised class="chilli" value="[[machineItem.$key]]" on-tap="removeMachine">REMOVE</paper-button>
            </div>
          </div>
        </li>
      </template>
    </ul>
  </template>
  <script>
    Polymer({
      is: 'view-setup-machine',
      toggleDialog: function () {
        this.$.createMachineDialog.open();
      },
      addMachine: function () {
          let today = new Date();
          let dd = today.getDate();
          let mm = today.getMonth() + 1; //January is 0!
          let yyyy = today.getFullYear();
        if (dd < 10) {
          dd = '0' + dd
        }
        if (mm < 10) {
          mm = '0' + mm
        }
        today = dd + '/' + mm + '/' + yyyy;

        this.$.machineQuery.ref.push({
          effi: this.$.machineEffi.value,
          install: today,
          name: this.$.machineName.value,
          queue: 0,
          status: 'Stopped',
          type: this.$.machineType.value,
        }).key;
        this.$.machineName.value = null;
        this.$.machineType.value = null;
      },
      editMachine: function(e) {
         let targetKey = e.currentTarget.value;
         this.$.targetKey.open();
        console.log(targetKey);

      },
      removeMachine: function(e) {
        let targetKey = e.currentTarget.value;
        console.log(targetKey);
        this.$.machineQuery.ref.child(targetKey).remove();
      },
      saveMachine: function(e) {

      },
      properties: {
        machineItems: {
          type: Object
        },
        machineType: {
          type: Array,
          value: function () {
            return [{
                name: 'Milling Machine',
                symbol: 'Milling',
                number: 0
              },
              {
                name: 'Drilling Machine',
                symbol: 'Drilling',
                number: 1
              },
              {
                name: 'Trimming Machine',
                symbol: 'Trimming',
                number: 2
              },
              {
                name: 'Polishing Machine',
                symbol: 'Polishing',
                number: 3
              },
              {
                name: 'Welding Machine',
                symbol: 'Welding',
                number: 4
              },
              {
                name: 'Packing Machine',
                symbol: 'Packing',
                number: 5
              }
            ]
          }
        }
      }
    });
  </script>
</dom-module>